Reuse code for Metal and WGSL entry point legalization (#6063)
9b977e59cf786bbb000b3b868b126c2b9a17d3f3
